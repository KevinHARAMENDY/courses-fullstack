<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KyZXEAg3QhqLMpG8r+8fhAXLRk2vvoC2f3B09zVXn8CA5QIVfZOJ3BCsw2P0p/We" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-U1DAWAznBHeqEIlVSCgzq+c9gqGAJn5c/t99JyeKa9xxaYpSvHU5awsuZVVFIhvj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.3/dist/umd/popper.min.js" integrity="sha384-eMNCOe7tC1doHpGoWe/6oMVemdAVTMs2xqW4mwXrXsW0L84Iytr2wi5v2QjrP/xp" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/js/bootstrap.min.js" integrity="sha384-cn7l7gDp0eyniUwwAZgrzD06kc/tftFf19TOAs2zVinnD/C7E91j9yyk5//jjpt/" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js" integrity="sha512-bZS47S7sPOxkjU/4Bt0zrhEtWx0y0CRkhEp8IckzK+ltifIIE9EMIMTuT/mEzoIMewUINruDBIR/jJnbguonqQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://kit.fontawesome.com/418cdd14aa.js" crossorigin="anonymous"></script>
    <title>JS</title>
</head>
<body>
    <div class="container">
        <div class="col-6">
            <h1 class="mb-5">Liste des courses dans l'API</h1>

            <button class="btn btn-success" onclick="ajouter()">
                <i class="fa fa-plus"></i>
            </button>
            <table class="table">
                <thead>
                  <tr>
                    <th>Article</th>
                    <th>Etat</th>
                    <th colspan="2">Actions</th>
                  </tr>
                </thead>
                <tbody id="tbody">
                </tbody>
            </table>
        </div>
    </div>

    <template id="ligneTableau">
        <tr>
          <td class="name">poire</td>
          <td class="status">true</td>
          <td>
            <button class="btn btn-primary" onclick="check(this)">
              <i class="fa fa-check"></i>
            </button>
            <button class="btn btn-danger" onclick="efface(this)">
              <i class="fa fa-trash"></i>
            </button>
          </td>
        </tr>
      </template>

      <script>
        let url = "http://localhost/tp-fullstack/backend/public/api/courses";
        
        function getLigne(article) {
          let template = document.getElementById("ligneTableau");
          let clone = template.content.cloneNode(true);

          if (article.pris == false) clone.querySelector(".status").innerHTML = "<i class='fas fa-times'></i>";
          else clone.querySelector(".status").innerHTML = "<i class='far fa-check-circle'></i>";

          clone.querySelector(".name").innerHTML = article.nom;
          clone.querySelector(".btn-primary").setAttribute("data-id", article.id);
          clone.querySelector(".btn-danger").setAttribute("data-id", article.id);
          return clone;
        }
  
        function ajouter() {
          let val = window.prompt("Quel est le nom de l'article ?");
          
          if (val != null) {
            let tbody = document.getElementById("tbody");
            let article = { id: 0, nom: val, pris: false };
            let tr = getLigne(article);
            tbody.appendChild(tr);
          }
        }

        function check(element) {
            let val_status = element.parentElement.parentElement.querySelector(".status");
            let val_name = element.parentElement.parentElement.querySelector(".name");
            
            let etat = val_status.outerHTML;

            let icone = 'fas fa-times';
            let colorTab = '';
            let barName = '';
            
            if (etat.includes("times")) {
                icone = 'far fa-check-circle';
                colorTab = 'table-danger';
                barName = 'text-decoration:line-through; color:grey';
            }
            
            val_status.innerHTML = "<i class='"+ icone +"'></i>";
            val_status.parentElement.setAttribute("class", colorTab);
            val_name.setAttribute("style", barName);
        }

        function efface(element) {
          let id = element.getAttribute("data-id");
          element.parentElement.parentElement.remove();
        }
        
        axios.get(url).then((response) => {
          let articles = response.data;
          for (let article of articles) {
            let tr = getLigne(article);
            tbody.appendChild(tr);
          }
        });
      </script>
</body>
</html>